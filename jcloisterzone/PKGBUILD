pkgname=jcloisterzone
pkgver=5.9.1
pkgrel=1
pkgdesc='Java implementation of Carcassonne board game.'
arch=('x86_64')
url="http://jcloisterzone.com/en/"
license=('AGPL')
depends=('java-runtime>=11')
makedepnds=('yarn')
source=("$pkgname-$pkgver.tar.gz::https://github.com/farin/JCloisterZone-Client/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('d4415f653f777403c95c87b89d3f654f5d5b901fbc5cc3a055d9731d799ea5c4')
options=('!strip')

build() {
    cd "$srcdir/JCloisterZone-Client-$pkgver"

    # Patch builder config to produce deb file instead of AppImage
    sed -i "s/'AppImage'/'deb'/g" builder.config.js

    yarn install --frozen-lockfile
    yarn run package

    # Extract data
    bsdtar -xv -C "./build" -f "./build/jcloisterzone-${pkgver}.deb"
}

package() {
    bsdtar -xv -C "$pkgdir" -f "$srcdir/JCloisterZone-Client-$pkgver/build/data.tar.xz"
}
